<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ƒê·∫∑t l·ªãch cho kh√°ch</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; padding: 1rem; }
    label { display: block; margin-top: 1rem; }
    select, input, button {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.25rem;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
    button {
      background-color: #4CAF50;
      color: white;
      margin-top: 1rem;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <h2>üßë‚Äçüíº ƒê·∫∑t l·ªãch cho kh√°ch h√†ng</h2>

  <form id="booking-form">
    <label for="customer">Kh√°ch h√†ng</label>
    <select id="customer" required>
      <option value="">-- Ch·ªçn kh√°ch h√†ng --</option>
    </select>

    <label for="type">Lo·∫°i bu·ªïi</label>
    <select id="type" required>
      <option value="HLV c√° nh√¢n">HLV c√° nh√¢n</option>
      <option value="HLV mi·ªÖn ph√≠">HLV mi·ªÖn ph√≠</option>
    </select>

    <label for="date">Ng√†y</label>
    <input type="date" id="date" required>

    <label for="time">Gi·ªù</label>
    <input type="time" id="time" required>

    <button type="submit">üì© G·ª≠i l·ªãch</button>
  </form>

  <script>
    // TODO: l·∫•y th√¥ng tin nh√¢n vi√™n t·ª´ Zalo userId
    const staffId = "demo_staff";

    async function fetchCustomers() {
      const res = await fetch(`https://script.google.com/macros/s/AKfycbzwxGR2zcEXTQFEeOSwPK4w7XkKZaXgKKOMBcBUGYxo0d8m28zvO1DxYlnJ2zgwkLm-1Q/exec`);
      const data = await res.json();
      const select = document.getElementById("customer");
      data.forEach(customer => {
        const option = document.createElement("option");
        option.value = customer.id;
        option.text = customer.name;
        select.appendChild(option);
      });
    }

    document.getElementById("booking-form").addEventListener("submit", async (e) => {
      e.preventDefault();

      const customerId = document.getElementById("customer").value;
      const type = document.getElementById("type").value;
      const date = document.getElementById("date").value;
      const time = document.getElementById("time").value;

      if (!customerId || !date || !time) {
        alert("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin.");
        return;
      }

      const res = await fetch(`https://script.google.com/macros/s/AKfycbzwxGR2zcEXTQFEeOSwPK4w7XkKZaXgKKOMBcBUGYxo0d8m28zvO1DxYlnJ2zgwkLm-1Q/exec`, {
        method: "POST",
        body: JSON.stringify({
          action: "create_booking",
          staffId,
          customerId,
          type,
          date,
          time
        }),
        headers: {
          "Content-Type": "application/json"
        }
      });

      const result = await res.json();
      if (result.success) {
        alert("‚úÖ ƒê·∫∑t l·ªãch th√†nh c√¥ng!");
        document.getElementById("booking-form").reset();
      } else {
        alert("‚ùå C√≥ l·ªói x·∫£y ra khi ƒë·∫∑t l·ªãch.");
      }
    });

    fetchCustomers();
  </script>
</body>
</html>
